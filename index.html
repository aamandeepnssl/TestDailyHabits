<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">

    <title>AD's Momentum</title>
    <link href="https://fonts.cdnfonts.com/css/product-sans" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { 
            --bg-overlay: rgba(18, 18, 18, 0.85); 
            --panel: rgba(45, 45, 45, 0.6); 
            --text: #ffffff; 
            --olive: #708238; 
            --orange: #ff8c00; 
            --grey: rgba(255, 255, 255, 0.1); 
            --danger: #b91d1d;
        }
        
        /* Fixed the background logic for iOS top-bar blending */
        html {
            background-color: #121212;
        }

        body { 
            font-family: 'Product Sans', 'Google Sans', sans-serif; 
            background: linear-gradient(var(--bg-overlay), var(--bg-overlay)), 
                        url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text); 
            padding: calc(20px + env(safe-area-inset-top)) 20px 20px 20px; 
            margin: 0; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container { max-width: 650px; margin: 0 auto; }
        
        h1.main-title { 
            text-align: center; 
            color: var(--orange); 
            font-size: 2.6rem; 
            margin-bottom: 0px; 
            letter-spacing: 2px; 
            font-weight: 700;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        .motto { 
            text-align: center; 
            font-size: 1.2rem; 
            color: var(--olive); 
            margin-top: 5px; 
            margin-bottom: 25px; 
            font-weight: 700;
            letter-spacing: 1.5px;
        }

        #quoteDisplay {
            text-align: center;
            font-style: italic;
            color: #ccc;
            margin-bottom: 30px;
            min-height: 45px;
            font-size: 0.95rem;
            padding: 0 30px;
            line-height: 1.5;
            text-transform: none;
            font-weight: 400;
        }
        
        .glass-panel {
            background: var(--panel);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .date-nav { display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--olive); }
        .nav-btn { background: var(--grey); border: none; color: white; padding: 10px 18px; cursor: pointer; font-family: inherit; transition: 0.2s; font-weight: 700; font-size: 0.8rem; border-radius: 8px; }
        .nav-btn:hover { background: var(--olive); }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { text-align: center; border-bottom: 3px solid var(--grey); padding: 15px; }
        .stat-card h3 { margin: 0; font-size: 0.8rem; color: var(--olive); font-weight: 700; }
        .stat-card span { display: block; font-size: 2.4rem; color: var(--orange); font-weight: 700; }

        .input-row { display: flex; width: 100%; gap: 10px; box-sizing: border-box; }
        input[type="text"] { flex-grow: 1; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--grey); color: white; font-family: inherit; font-size: 1rem; text-transform: uppercase; border-radius: 8px; }
        
        .task-item { 
            display: flex; 
            align-items: center; 
            background: rgba(255, 255, 255, 0.05); 
            padding: 15px; 
            margin-bottom: 10px; 
            justify-content: space-between; 
            border-right: 4px solid var(--grey); 
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }
        
        .del-btn { background: none; border: none; color: #888; cursor: pointer; font-family: inherit; font-weight: 700; padding: 5px 10px; transition: 0.3s; font-size: 0.8rem; }
        .del-btn:hover { color: #fff; background: var(--danger); border-radius: 6px; }

        #deleteModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }
        .modal-content { background: #1e1e1e; padding: 35px; border: 1px solid var(--grey); text-align: center; max-width: 320px; border-radius: 16px; }
        .modal-btns { display: flex; gap: 15px; justify-content: center; margin-top: 25px; }
        .confirm-btn { background: var(--danger); color: white; border: none; padding: 10px 20px; cursor: pointer; font-family: inherit; font-weight: 700; border-radius: 8px; }
        .cancel-btn { background: var(--grey); color: white; border: none; padding: 10px 20px; cursor: pointer; font-family: inherit; border-radius: 8px; }

        .heatmap-container { border-top: 3px solid var(--orange); padding: 20px; }
        .heatmap-grid { display: grid; grid-template-columns: repeat(20, 1fr); gap: 4px; margin-top: 15px; }
        .heat-square { aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 2px; }
        .level-1 { background: #2d3319; } .level-2 { background: #4b5826; } .level-3 { background: #708238; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="deleteModal">
    <div class="modal-content">
        <p style="font-size: 1rem; margin: 0; letter-spacing: 0.5px; font-weight: 700;">ARE YOU SURE YOU WANT TO DELETE THIS TASK?</p>
        <div class="modal-btns">
            <button class="confirm-btn" id="confirmDelete">YES, DELETE</button>
            <button class="cancel-btn" onclick="closeModal()">CANCEL</button>
        </div>
    </div>
</div>

<div class="container">
    <h1 class="main-title">AD'S MOMENTUM</h1>
    <p class="motto">Consistency is the only currency.</p>
    <div id="quoteDisplay">"LOADING MOTIVATION..."</div>

    <div class="date-nav glass-panel">
        <button class="nav-btn" onclick="changeDate(-1)">PREV</button>
        <h2 id="currentDateDisplay" style="margin:0; font-size: 1.1rem;">LOADING...</h2>
        <button class="nav-btn" onclick="changeDate(1)">NEXT</button>
    </div>

    <div class="dashboard">
        <div class="stat-card glass-panel"><h3>DAILY PROGRESS</h3><span id="dailyStat">0%</span></div>
        <div class="stat-card glass-panel"><h3>STREAK</h3><span id="streakStat">0 DAYS</span></div>
    </div>

    <div class="add-box glass-panel">
        <div class="input-row">
            <input type="text" id="taskInput" placeholder="NEW HABIT...">
            <button onclick="addTask()" style="background:var(--olive); color:white; border:none; padding:10px 20px; cursor:pointer; font-family:inherit; font-weight: 700; white-space: nowrap; font-size: 0.8rem; border-radius: 8px;">ADD TASK</button>
        </div>
        <div style="margin-top:15px;">
            <label style="cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 8px; font-weight: 700;">
                <input type="checkbox" id="isRecurring" onchange="toggleDayPicker()"> SET AS RECURRING?
            </label>
            <div id="dayPicker" class="day-picker hidden" style="display:flex; justify-content:space-between; margin-top:15px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px;">
                <label style="font-size:0.6rem;"><input type="checkbox" value="1"> MON</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="2"> TUE</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="3"> WED</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="4"> THU</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="5"> FRI</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="6"> SAT</label>
                <label style="font-size:0.6rem;"><input type="checkbox" value="0"> SUN</label>
            </div>
        </div>
    </div>

    <div id="taskList"></div>

    <div class="heatmap-container glass-panel">
        <h3 style="margin-top:0; font-size: 1rem; color: var(--olive); font-weight: 700;">MOMENTUM HEATMAP</h3>
        <div id="heatmapGrid" class="heatmap-grid"></div>
    </div>
</div>

<script>
    /* --- INSERT YOUR FIREBASE CONFIG --- */
    const firebaseConfig = {
        apiKey: "AIzaSyCP8ZsngB137J1q186KHYeQKsIXzTbq580",
            authDomain: "mydailyhabits-5b16d.firebaseapp.com",
            databaseURL: "https://mydailyhabits-5b16d-default-rtdb.firebaseio.com",
            projectId: "mydailyhabits-5b16d",
            storageBucket: "mydailyhabits-5b16d.firebasestorage.app",
            messagingSenderId: "50093682600",
            appId: "1:50093682600:web:26644d7a3deb366ee3379d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let currentViewingDate = new Date();
    currentViewingDate.setHours(0,0,0,0);
    let taskToDelete = null;

    const momentumQuotes = [
        "Discipline is doing what needs to be done, even if you don't want to do it.",
        "Suffer the pain of discipline or suffer the pain of regret.",
        "Consistency transforms average into excellence.",
        "Show up when nobody is watching. That’s where the gap is created.",
        "The best gift you can give your family is a stronger version of yourself.",
        "Amateurs wait for motivation. Pros get to work.",
        "Your habits are either your best servant or your worst master.",
        "Happiness is found in progress, not perfection.",
        "A healthy body is a temple; don't let the fire go out.",
        "Speed is great, but direction is everything. Stay consistent.",
        "Don't lower the goal, increase the effort.",
        "Success is the sum of small efforts repeated day in and day out.",
        "The gym isn't just about muscle; it's about proving you can't be broken.",
        "Protect your peace. Protect your family. Protect your momentum.",
        "It doesn't have to be fun to be effective.",
        "A man who has no control over his spirit is like a city with broken walls.",
        "Your family doesn't need your excuses, they need your presence.",
        "Workout today. Future you will thank you.",
        "If you want to move a mountain, start with the small stones.",
        "Excellence is not an act, but a habit.",
        "The only bad workout is the one that didn't happen.",
        "Lead by example. Your children are watching your habits, not your words.",
        "Intensity is the price of entry. Consistency is the price of victory.",
        "Hard days are where the real work happens.",
        "Be the man you wanted your father to be.",
        "Don't count the days, make the days count.",
        "Motivation gets you started; discipline keeps you going.",
        "Everything you want is on the other side of consistency.",
        "Small wins lead to big victories. Check the box.",
        "Legacy is built in the quiet hours of the early morning.",
        "Health is the foundation of every other success.",
        "The struggle you are in today is developing the strength you need for tomorrow.",
        "Focus on the process, and the results will take care of themselves.",
        "Your potential is only limited by your consistency.",
        "You don't find time, you make time.",
        "Greatness is found in the things no one wants to do.",
        "One percent better every day is 37 times better in a year.",
        "Be obsessed with the man you are becoming.",
        "Fatigue is the price of progress. Pay it gladly.",
        "Don't mistake motion for progress. Stay on the mission.",
        "A bad day is no excuse for a bad habit.",
        "The goal is not to be better than anyone else, but your previous self.",
        "Strength comes from what you thought you couldn't do.",
        "Love your family, work super hard, live your passion.",
        "The pain of the workout is nothing compared to the pain of being weak.",
        "Consistency is the playground of winners.",
        "Master your morning, master your life.",
        "No one ever regretted a workout after it was finished.",
        "You are the architect of your own momentum.",
        "If it’s important, you’ll find a way. If not, you’ll find an excuse.",
        "Strong fathers build strong futures.",
        "The best project you will ever work on is you.",
        "Discipline equals freedom.",
        "Results happen over time, not overnight. Stay patient.",
        "Action is the antidote to anxiety.",
        "What you do today defines who you are tomorrow.",
        "Sweat is just weakness leaving the body.",
        "The grind is quiet. The success is loud.",
        "Your family is the 'Why.' Your discipline is the 'How.'",
        "Don't stop when you're tired, stop when you're done."
    ];

    function displayQuote() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 1000 * 60 * 60 * 24;
        const dayOfYear = Math.floor(diff / oneDay);
        const index = dayOfYear % momentumQuotes.length;
        document.getElementById('quoteDisplay').innerText = `"${momentumQuotes[index]}"`;
    }

    function toggleDayPicker() {
        const picker = document.getElementById('dayPicker');
        const isChecked = document.getElementById('isRecurring').checked;
        if(isChecked) picker.classList.remove('hidden');
        else picker.classList.add('hidden');
    }

    function changeDate(days) { 
        currentViewingDate.setDate(currentViewingDate.getDate() + days); 
        render(); 
    }

    function formatDate(date) {
        const d = new Date(date);
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
        return d.toISOString().split('T')[0];
    }

    function openDeleteModal(taskId) {
        taskToDelete = taskId;
        document.getElementById('deleteModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
        taskToDelete = null;
    }

    document.getElementById('confirmDelete').onclick = function() {
        if(taskToDelete) {
            db.ref('habits/definitions').once('value', snap => {
                snap.forEach(child => { if(child.val().id == taskToDelete) child.ref.remove(); });
            });
            closeModal();
        }
    };

    function addTask() {
        const text = document.getElementById('taskInput').value;
        const isRec = document.getElementById('isRecurring').checked;
        const days = Array.from(document.querySelectorAll('#dayPicker input:checked')).map(i => parseInt(i.value));
        if(!text) return;
        db.ref('habits/definitions').push({ 
            id: Date.now(), text, recurring: isRec, days: isRec ? days : null, createdDate: formatDate(currentViewingDate) 
        });
        document.getElementById('taskInput').value = "";
        document.getElementById('isRecurring').checked = false;
        toggleDayPicker();
    }

    function toggleCheck(taskId) {
        const key = formatDate(currentViewingDate);
        const ref = db.ref(`habits/progress/${key}/${taskId}`);
        ref.once('value', s => ref.set(!s.val()));
    }

    function updateStats(allData) {
        const defs = allData.definitions || {};
        const prog = allData.progress || {};
        const grid = document.getElementById('heatmapGrid');
        grid.innerHTML = "";
        
        for (let i = 99; i >= 0; i--) {
            const d = new Date(); d.setDate(d.getDate() - i); d.setHours(0,0,0,0);
            const key = formatDate(d);
            const dow = d.getDay();
            let total = 0, done = 0;
            Object.values(defs).forEach(t => {
                if ((!t.recurring && t.createdDate === key) || (t.recurring && t.days && t.days.includes(dow))) {
                    total++; if (prog[key] && prog[key][t.id]) done++;
                }
            });
            const pct = total > 0 ? (done / total) : -1;
            let level = "level-0";
            if (pct > 0) level = "level-1"; if (pct > 0.6) level = "level-2"; if (pct === 1) level = "level-3";
            grid.innerHTML += `<div class="heat-square ${level}" title="${key}"></div>`;
        }

        let streak = 0; let sDate = new Date(); sDate.setHours(0,0,0,0);
        let safety = 0;
        if (Object.keys(defs).length > 0) {
            while (safety < 365) {
                const key = formatDate(sDate);
                const dow = sDate.getDay();
                let scheduled = 0, completed = 0;
                Object.values(defs).forEach(t => {
                    if ((!t.recurring && t.createdDate === key) || (t.recurring && t.days && t.days.includes(dow))) {
                        scheduled++; if (prog[key] && prog[key][t.id]) completed++;
                    }
                });
                if (scheduled > 0) {
                    if (completed === scheduled) { streak++; } else { break; }
                }
                sDate.setDate(sDate.getDate() - 1); safety++;
            }
        }
        document.getElementById('streakStat').innerText = streak + " DAYS";
    }

    function render() {
        const dateKey = formatDate(currentViewingDate);
        document.getElementById('currentDateDisplay').innerText = currentViewingDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        displayQuote();
        
        db.ref('habits').on('value', snap => {
            const data = snap.val() || {};
            const defs = data.definitions || {};
            const prog = (data.progress && data.progress[dateKey]) ? data.progress[dateKey] : {};
            const listDiv = document.getElementById('taskList');
            listDiv.innerHTML = "";
            let total = 0, done = 0;

            Object.values(defs).forEach(task => {
                const isToday = (!task.recurring && task.createdDate === dateKey) || (task.recurring && task.days && task.days.includes(currentViewingDate.getDay()));
                if (isToday) {
                    total++; 
                    const isChecked = prog[task.id] || false; if(isChecked) done++;
                    listDiv.innerHTML += `
                        <div class="task-item">
                            <div style="display:flex; align-items:center; gap:15px;">
                                <input type="checkbox" ${isChecked ? 'checked' : ''} onclick="toggleCheck(${task.id})">
                                <span style="${isChecked ? 'text-decoration:line-through; color:#aaa' : ''}">${task.text}</span>
                            </div>
                            <button class="del-btn" onclick="openDeleteModal(${task.id})">REMOVE</button>
                        </div>`;
                }
            });
            document.getElementById('dailyStat').innerText = (total > 0 ? Math.round((done / total) * 100) : 0) + "%";
            updateStats(data);
        });
    }
    render();
</script>
</body>
</html>
